{
  "handler": "Microsoft.Compute.MultiVm",
  "version": "0.0.1-preview",
  "parameters": {
    "basics": [
      {
        "name": "adminUsername",
        "type": "Microsoft.Compute.UserNameTextBox",
        "label": "User name",
        "defaultValue": "",
        "toolTip": "Specify a user for accessing the virtual machines within your cluster. Must be a valid Ubuntu username",
        "constraints": {
          "required": true,
          "regex": "^(?!(?:adm|admin|audio|backup|bin|cdrom|crontab|daemon|dialout|dip|disk|fax|floppy|fuse|games|gnats|irc|kmem|landscape|libuuid|list|lp|mail|man|messagebus|mlocate|netdev|news|nobody|nogroup|operator|plugdev|proxy|root|sasl|shadow|src|ssh|sshd|staff|sudo|sync|sys|syslog|tape|tty|users|utmp|uucp|video|voice|whoopsie|www\\-data)$)\\w+$",
          "validationMessage": "Username must not be a reserved Ubuntu username"
        },
        "osPlatform": "Linux"
      },
      {
        "name": "password",
        "type": "Microsoft.Compute.CredentialsCombo",
        "label": {
          "authenticationType": "Authentication type",
          "password": "Password",
          "confirmPassword": "Confirm password",
          "sshPublicKey": "SSH public key"
        },
        "toolTip": {
          "authenticationType": "Choose Authentication type Password or PublicKey(SSH).",
          "password": "Enter the password for the specified user name.",
          "sshPublicKey": "Copy Public key into field."
        },
        "constraints": {
          "required": true
        },
        "options": {
          "hideConfirmation": false
        },
        "osPlatform": "Linux"
      }
    ],
    "steps": [
      {
        "name": "veeamHubSettings",
        "label": "veeamHubSettings",
        "subLabel": {
          "preValidation": "Required",
          "postValidation": "Done"
        },
        "bladeTitle": "veeamHubSettings",
        "elements": [
          {
            "name": "veeamHubName",
            "type": "Microsoft.Common.TextBox",
            "label": "VM name",
            "defaultValue": "",
            "toolTip": "Name your Veeam HUB machine.",
            "constraints": {
              "required": true,
              "regex": "[^\\s]+$",
              "validationMessage": "VM has trailing whitespace"
            }
          },
          {
            "name": "clusterVmSize",
            "type": "Microsoft.Compute.SizeSelector",
            "label": "Virtual machine size",
            "toolTip": "The size of virtual machine to provision for each cluster node.",
            "recommendedSizes": [
                "Standard_A0",
                "Standard_A1"
            ],
            "constraints": {
                "allowedSizes": [
                    "Standard_A0",
                    "Standard_A1"
                ]
            },
            "osPlatform": "Linux",
            "imageReference": {
                "publisher": "Canonical",
                "offer": "UbuntuServer",
                "sku": "14.04.2-LTS"
            }
          },          
            {
            "name": "virtualNetwork",
            "type": "Microsoft.Network.VirtualNetworkCombo",
            "label": {
              "virtualNetwork": "Virtual network",
              "subnets": "Subnet"
            },
            "toolTip": {
              "virtualNetwork": "Create a new Virtual Network or use an existing one",
              "subnets": "Choose the Subnet for the Virtual Network for Elasticsearch nodes. If choosing an existing Virtual Network, the Subnet to use will need to exist beforehand; Creating a new subnet in an existing Virtual Network is not supported"
            },
            "defaultValue": {
              "name": "es-net",
              "addressPrefixSize": "/16"
            },
            "constraints": {
              "minAddressPrefixSize": "/16"
            },
            "options": {
              "hideExisting": false
            },
            "subnets": {
              "subnet1": {
                "label": "subnet",
                "defaultValue": {
                  "name": "es-subnet",
                  "addressPrefixSize": "/24"
                },
                "constraints": {
                  "minAddressPrefixSize": "/24",
                  "minAddressCount": 12,
                  "requireContiguousAddresses": true
                }
              }
            }
          }
        ],
    "outputs": {
      "esVersion": "[steps('clusterSettingsStep').esVersion]",
      "esClusterName": "[steps('clusterSettingsStep').esClusterName]",
      "loadBalancerType": "[steps('externalAccessStep').loadBalancerType]",
      "vNetNewOrExisting": "[steps('clusterSettingsStep').virtualNetwork.newOrExisting]",
      "vNetName": "[steps('clusterSettingsStep').virtualNetwork.name]",
      "vNetSubnetName": "[steps('clusterSettingsStep').virtualNetwork.subnets.subnet1.name]",
      "vNetLoadBalancerIp": "[steps('clusterSettingsStep').virtualNetwork.subnets.subnet1.startAddress]",
      "vNetExistingResourceGroup": "[steps('clusterSettingsStep').virtualNetwork.resourceGroup]",
      "vNetNewAddressPrefix": "[steps('clusterSettingsStep').virtualNetwork.addressPrefix]",
      "vNetNewSubnetAddressPrefix": "[steps('clusterSettingsStep').virtualNetwork.subnets.subnet1.addressPrefix]",
      "kibana": "[steps('externalAccessStep').kibana]",
      "jumpbox": "[steps('externalAccessStep').jumpbox]",
      "vmSizeDataNodes": "[steps('nodesStep').vmSizeDataNodes]",
      "vmDataNodeCount": "[steps('nodesStep').vmDataNodeCount]",
      "dataNodesAreMasterEligible": "[steps('nodesStep').dataNodesAreMasterEligible]",
      "vmHostNamePrefix": "[steps('nodesStep').vmHostNamePrefix]",
      "vmSizeMasterNodes": "[steps('nodesStep').vmSizeMasterNodes]",
      "vmClientNodeCount": "[steps('nodesStep').vmClientNodeCount]",
      "vmSizeClientNodes": "[steps('nodesStep').vmSizeClientNodes]",
      "vmSizeKibana": "[steps('externalAccessStep').vmSizeKibana]",
      "adminUsername": "[basics('adminUsername')]",
      "authenticationType": "[basics('password').authenticationType]",
      "adminPassword": "[basics('password').password]",
      "sshPublicKey": "[basics('password').sshPublicKey]",
      "shieldAdminPassword": "[steps('shieldStep').es_admin.shieldAdminPassword]",
      "shieldReadPassword": "[steps('shieldStep').es_read.shieldReadPassword]",
      "shieldKibanaPassword": "[steps('shieldStep').es_kibana.shieldKibanaPassword]",
      "location": "[location()]",
      "userCompany": "[steps('userInformationStep').userCompany]",
      "userEmail": "[steps('userInformationStep').userEmail]",
      "userFirstName": "[steps('userInformationStep').userFirstName]",
      "userLastName": "[steps('userInformationStep').userLastName]",
      "userJobTitle": "[steps('userInformationStep').userJobTitle]",
      "userCountry": "[steps('userInformationStep').userCountry]"
    }
  }
}
